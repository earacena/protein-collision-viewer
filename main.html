<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
      }
      
      div {
	  display: inline-block;
	  justify-content: space-between;
      }
      
      .tab {
	  overflow: hidden;
	  border: 1px solid #ccc;
	  background-color: #f1f1f1;
      }

      .tab button {
	  background-color: inherit;
	  float: left;
	  border: none;
	  outline: none;
	  cursor: pointer;
	  padding: 14px 16px;
	  transition: 0.3s;
	  font-size: 17px;
      }

      .tab button:hover {
	  background-color: #ddd;
      }

      .tab button.active {
	  background-color: #ccc;
      }

      .tabcontent {
	  display: none;
	  padding: 6px 12px;
	  border: 1px solid #ccc;
	  border-top: none;
      }
    </style>

    <meta charset="utf-8">
    <title>JSmol -- Jmol/HTML5 Demo</title>
    <script type="text/javascript" src="JSmol.min.js"></script>

    <script type="text/javascript">

      Jmol._isAsync = false;

      // last update 2/18/2014 2:10:06 PM

      var jmolApplet0; // set up in HTML table, below

      // logic is set by indicating order of USE -- default is HTML5 for this test page, though

      var s = document.location.search;

      // Developers: The _debugCode flag is checked in j2s/core/core.z.js, 
      // and, if TRUE, skips loading the core methods, forcing those
      // to be read from their individual directories. Set this
      // true if you want to do some code debugging by inserting
      // System.out.println, document.title, or alert commands
      // anywhere in the Java or Jmol code.

      Jmol._debugCode = (s.indexOf("debugcode") >= 0);

      jmol_isReady = function(applet) {
	  document.title = ("Amino Acid Collision Viewer")
	  Jmol._getElement(applet, "appletdiv").style.border="1px solid blue"
      }		

      var Info = {
	  width: 800,
	  height: 600,
	  debug: false,
	  color: "0xFFFFFF",
	  //addSelectionOptions: true,
	  use: "HTML5",   // JAVA HTML5 WEBGL are all options
	  j2sPath: "./j2s", // this needs to point to where the j2s directory is.
	  jarPath: "./java",// this needs to point to where the java directory is.
	  jarFile: "JmolAppletSigned.jar",
	  isSigned: true,
	  script: "set zoomlarge false;set antialiasDisplay;load data/ala.pdb;set spin on;",
	  serverURL: "https://chemapps.stolaf.edu/jmol/jsmol/php/jsmol.php",
	  readyFunction: jmol_isReady,
	  disableJ2SLoadMonitor: true,
	  disableInitialConsole: true,
	  allowJavaScript: true
	  //defaultModel: "$dopamine",
	  //console: "none", // default will be jmolApplet0_infodiv, but you can designate another div here or "none"
      }

      // -----  Molecule manipulation code ----- //

      // Global variables, initialized with default molecule
      var aminoAcid = "ala";

      // Phi torsion angle
      var phi = 0;

      // Psi torsion angle
      var psi = -90;

      // plane flags
      var plane_flag = false;

      // Load molecule
      function load_molecule() {
	  aminoAcid = document.getElementById("menu").value;
	  var filename = aminoAcid;
	  if (aminoAcid == "ala-gly") {
	      filename = filename + ".mol";
	  } else {
	      filename = filename + ".pdb";
	  }
	  // JSmol load
	  Jmol.script(jmolApplet0, '!quit;load ./data/' + filename);
	  phi = 0;
	  document.getElementById("phi").innerText = readphi();

	  if (aminoAcid == "ala") {
	      psi = -90;
	  } else {
	      psi = 0;
	  }
	  document.getElementById("psi").innerText = readphi();

	  load_rama();
	  return;
      }

      function load_rama() {
	  aminoAcid = document.getElementById("menu").value;
	  var filename = aminoAcid + "_plot.png";
	  
	  var canvas = document.getElementById("ramacanvas");
	  var context = canvas.getContext("2d");
	  var background = new Image();
	  background.src = "https://raw.githubusercontent.com/earacena/protein-collision-viewer/master/data/" + filename;
	  background.onload = function() {
	      context.drawImage(background, 0, 0);
	      place_axis();
	      update_rama();
	      
	  }
	  return; 
      }

      function place_axis() {
	  var canvas = document.getElementById("ramacanvas");
	  var context = canvas.getContext("2d");
	  context.fillStyle = "red";
	  context.font = "17px Arial";
	  // Draw vertical line
	  context.fillText("180 (Psi)", 185, 20);
	  context.strokeStyle = "red";
	  context.beginPath();
	  context.moveTo(180, 0);
	  context.lineTo(180, 360);
	  context.stroke();
	  context.closePath();
	  context.fillText("-180 (Psi)", 185, 350)
	  
	  // Draw horizontal line
	  // y axis needs to be inverted 
	  context.fillText("-180 (Phi)", 10, 175);
	  context.strokeStyle = "red";
	  context.beginPath();  
	  context.moveTo(0, 180);
	  context.lineTo(360, 180);
	  context.stroke();
	  context.closePath();
	  context.fillText("(Phi) 180", 290, 175)

	  return; 
      }
      
      function update_rama() {

	  // Clear canvas to plot image
	  var canvas = document.getElementById("ramacanvas");
	  var context = canvas.getContext("2d");
	  var background = new Image();
	  aminoAcid = document.getElementById("menu").value;
	  var filename = aminoAcid + "_plot.png";
	  background.src = "https://raw.githubusercontent.com/earacena/protein-collision-viewer/master/data/" + filename;
	  background.onload = function() {
	      context.drawImage(background, 0, 0);
	      place_axis();
	      // Draw vertical line
	      context.strokeStyle = "black";
	      context.beginPath();
	      context.moveTo(180+phi, 0);
	      context.lineTo(180+phi, 360);
	      context.stroke();
	      context.closePath();
	      
	      // Draw horizontal line
	      // y axis needs to be inverted 
	      context.beginPath();  
	      context.moveTo(0, 180+(-1*psi));
	      context.lineTo(360, 180+(-1*psi));
	      context.stroke();
	      context.closePath();
	      
	  }

	  return;
      }

      function update_clashes() {
	  // To return the number of atoms in clash, use this script format:
	  // x = contact({atomset1} {atomset2});set background [x*90, 0, 0]
	  Jmol.script(jmolApplet0, 'contact delete;contact {hydrogen or oxygen or carbon or nitrogen} {hydrogen or oxygen or carbon or nitrogen};')
	  
	  return;
      }

      function phi_rotate_plus() { 
	  if (aminoAcid == "ala") {
	      // Alanine
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 4) -10 -30');
	  } else if (aminoAcid == "ala-gly") {
	      // ALA-GLY
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 4) (atomno = 9) -10 -30');
	  } else if (aminoAcid == "arg") {
	      // ARG
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 4) -10 -30');
	  } else if (aminoAcid == "gly") {
	      // GLY
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 4) -10 -30');
	  }
	  phi = phi + 10;
	  phi = normalize(phi);
	  document.getElementById("phi").innerText = readphi();
	  return;
      }

      function phi_rotate_minus() {
	  if (aminoAcid == "ala") {
	      // Alanine
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 4) 10 30');
	  } else if (aminoAcid == "ala-gly") {
	      // ALA-GLY
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 4) (atomno = 9) 10 30');
	  } else if (aminoAcid == "arg") {
	      
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 4) 10 30');
	  } else if (aminoAcid == "gly") {
	      // GLY
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 4) 10 30');
	  }
	  phi = phi - 10;
	  phi = normalize(phi);
	  document.getElementById("phi").innerText = readphi();
	  return;
      }

      function psi_rotate_plus() {
	  if (aminoAcid == "ala") {
	      // ALANINE
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 5) -10 -30');
	  } else if (aminoAcid == "ala-gly") {
	      // ALA-GLY
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 4) (atomno = 7) -10 -30');
	  } else if (aminoAcid == "arg") {
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 5) -10 -30');
	  } else if (aminoAcid == "gly") {
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 5) -10 -30');
	  }
	  psi = psi + 10;
	  psi = normalize(psi);
	  document.getElementById("psi").innerText = readpsi();
	  return;
      }

      function psi_rotate_minus() {
	  if (aminoAcid == "ala") {
	      // ALANINE
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 5) 10 30');
	  } else if (aminoAcid == "ala-gly") {
	      // ALA-GLY
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 4) (atomno = 7) 10 30');
	  } else if (aminoAcid == "arg") {
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 5) 10 30');
	  } else if (aminoAcid == "gly") {
	      Jmol.script(jmolApplet0, 'rotate MOLECULAR BRANCH (atomno = 7) (atomno = 5) 10 30');
	  } 
	  psi = psi - 10;
	  psi = normalize(psi);
	  document.getElementById("psi").innerText = readpsi();
	  return;
      }

      function update_psi_text() {
	  document.getElementById("psi").value = readpsi();
      }

      function update_phi_text() {
	  document.getElementById("phi").value = readphi();
      }

      function normalize(angle) {
	  let normalized = angle;
	  if (normalized <= -179)
	      normalized += 360;
	  if (normalized > 180)
	      normalized -= 360;
	  return normalized;
      }

      function readpsi() {
	  return psi.toString();
      }

      function readphi(){
	  return phi.toString();
      }

      function readamino() {
	  return aminoAcid;
      }

      function toggle_vdw() {
	  var checkbox = document.getElementById("vdw_checkbox");
	  if (checkbox.checked == true) {
	      Jmol.script(jmolApplet0, 'isoSurface solvent;color isoSurface translucent');
	  } else {
	      Jmol.script(jmolApplet0, 'isoSurface off');
	      update_clashes();
	  }
      }

      $(document).ready(function() {
	  $("#appdiv").html(Jmol.getAppletHtml("jmolApplet0", Info))
      })

      var lastPrompt=0;




    </script>
  </head>
  <body onload="load_rama();update_rama();">

    <center><font size="6"> Amino Acid Collision Viewer with live Ramachandran plot. </font></center>
    <center>
      <div class=div1>
	<div>
	  <h2 style = "color : black;">Ramachandran plot:</h2>
	  <canvas width=360 height=360 id="ramacanvas"></canvas>
	</div>
	<div id="appdiv"></div>
	<div>
	  <h2 style = "color : black;">Amino Acid:</h2>
	  <select id="menu">
	    <option value = "ala">Alanine (ALA)</option> 
	    <option value = "gly">Glycine (GLY)</option>
	  </select>
	  <button onclick="load_molecule();">Load</button>

	  <br><br><input type="checkbox" id="vdw_checkbox" onclick="toggle_vdw();"> Enable Van der Waals<br> 

	  <h2 style ="color : black;">Phi Rotation:</h2>
	  <button onclick="phi_rotate_plus();update_clashes();update_rama();">+ 10</button>
	  <button onclick="phi_rotate_minus();update_clashes();update_rama();">- 10</button>
	  <p> Current degree : </p> <p id ="phi">0</p>
	  
	  
	  
	  <h2 style ="color : black;">Psi Rotation: </h2>
	  <button onclick="psi_rotate_plus();update_clashes();update_rama();">+ 10</button>
	  <button onclick="psi_rotate_minus();update_clashes();update_rama();">- 10</button>
	  <p> Current degree : </p> <p id="psi">-90</p>

	</div>
      </div>
    </center>
    <br>
    <br>
    <center>
      <div class="tab">
	<button class="tablink" onclick="open_tab(event, 'TabA')">Tab A, EDIT THIS</button>
	<button class="tablink" onclick="open_tab(event, 'TabB')">Tab B, EDIT THIS</button>
	<button class="tablink" onclick="open_tab(event, 'TabC')">Tab C, EDIT THIS</button>
	<button class="tablink" onclick="open_tab(event, 'TabD')">Tab e, EDIT THIS</button>
      </div>

      <div id="TabA" class="tabcontent">
	<p>This is the text inside of Tab A, EDIT THIS.</p>
      </div>

      <div id="TabB" class="tabcontent">
	<p>This is the text inside of Tab B, EDIT THIS.</p> 
      </div>

      <div id="TabC" class="tabcontent">
	<p>This is is the text inside of Tab C, EDIT This</p>
      </div>

      <div id="TabD" class="tabcontent">
	<p>This is is the text inside of Tab D, EDIT This</p>
      </div>
      
      <script>
	function open_tab(event, tabname) {
	    var i, tabcontent, tablink;
	    tabcontent = document.getElementsByClassName("tabcontent");
	    for (i = 0; i < tabcontent.length; i++) {
		tabcontent[i].style.display = "none";
	    }
	    tablink = document.getElementsByClassName("tablink");
	    for (i = 0; i < tablink.length; i++) {
		tablink[i].className = tablink[i].className.replace(" active", "");
	    }
	    document.getElementById(tabname).style.display = "block";
	    event.currentTarget.className += " active";
	}
      </script> 
    </center>

  </body>
</html>
